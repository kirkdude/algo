# Quantum-Safe Cryptography Policy Configuration
# Generated by Algo VPN quantum-safe role
# Timestamp: {{ ansible_date_time.iso8601 }}

policy:
  version: "1.0"
  description: "Quantum-Safe Cryptography Policy for Algo VPN"

  # Security Level Requirements
  security_levels:
    minimum: "{{ 'category_1' if default_security_level == 'ML-KEM-512' else 'category_3' if default_security_level == 'ML-KEM-768' else 'category_5' }}"
    recommended: "category_3"  # ML-KEM-768 / 192-bit security
    maximum: "category_5"     # ML-KEM-1024 / 256-bit security

  # Algorithm Preferences
  algorithms:
    key_encapsulation:
      primary: "{{ default_security_level }}"
      fallback:
        - "ML-KEM-768"
        - "ML-KEM-512"
      classical_fallback:
        - "ECDH-P384"
        - "ECDH-P256"

    digital_signature:
      primary: "{{ default_signature_level }}"
      fallback:
        - "ML-DSA-65"
        - "ML-DSA-44"
      classical_fallback:
        - "ECDSA-P384"
        - "ECDSA-P256"

  # Operational Modes
  modes:
    current: "{{ quantum_safe_mode }}"
    allowed:
      - "hybrid"      # Classical + Post-Quantum
      - "pure_pq"     # Pure Post-Quantum (future)
      - "classical"   # Classical only (fallback)

    transition_policy:
      enable_hybrid: true
      require_pq_support: {{ quantum_safe_testing | lower }}
      fallback_on_error: {{ enable_fallback_mode | lower }}

  # Performance Considerations
  performance:
    optimization: "{{ quantum_safe_optimization }}"

    acceptable_overhead:
      cpu: "3x"           # Up to 3x CPU overhead acceptable
      memory: "20%"       # Up to 20% memory overhead acceptable
      bandwidth: "50x"    # Up to 50x key size increase acceptable

    monitoring:
      enabled: {{ performance_monitoring | lower }}
      thresholds:
        cpu_usage: 80
        memory_usage: 85
        connection_time: 30  # seconds

  # Integration Requirements
  integration:
    strongswan:
      enabled: {{ integrate_with_strongswan | lower }}
      version_minimum: "6.0.0"
      required_plugins: ["oqs", "openssl", "kernel-netlink"]

    wireguard:
      enabled: {{ integrate_with_wireguard | lower }}
      implementation: "kernel"  # Phase 3 feature

    compatibility:
      legacy_clients: {{ enable_fallback_mode | lower }}
      android_support: false    # Future enhancement
      ios_support: false        # Awaiting Apple implementation
      windows_support: false    # Awaiting Microsoft implementation

  # Security Hardening
  hardening:
    disable_weak_algorithms: true
    require_forward_secrecy: true
    minimum_key_sizes:
      classical_ecdh: 256
      classical_rsa: 3072
      pq_kem: 512

    certificate_validation:
      strict_mode: true
      revocation_checking: true

  # Compliance and Auditing
  compliance:
    frameworks:
      - "NIST Post-Quantum Cryptography Standards"
      - "CNSA 2.0"
      - "BSI TR-02102-1"

    audit_logging:
      enabled: {{ quantum_safe_logging != 'error' }}
      level: "{{ quantum_safe_logging }}"
      retention_days: 90

  # Development and Testing
  development:
    test_mode: {{ quantum_safe_dev_mode | lower }}
    deterministic_keys: {{ quantum_safe_deterministic_keys | lower }}
    debug_logging: {{ quantum_safe_logging == 'debug' }}

    testing:
      algorithm_validation: {{ quantum_safe_testing | lower }}
      performance_benchmarks: {{ quantum_safe_benchmarks | lower }}
      interoperability_tests: true

  # Migration Strategy
  migration:
    phase: "2"  # Current phase: Implementation and Testing
    timeline:
      phase_1_complete: "2024-12-31"  # Research and Development
      phase_2_target: "2025-06-30"    # Implementation and Testing
      phase_3_target: "2025-12-31"    # Full Production Deployment

    rollback_plan:
      enabled: {{ backup_classical_configs | lower }}
      automatic_rollback: {{ enable_fallback_mode | lower }}
      rollback_triggers:
        - "connection_failure_rate > 10%"
        - "performance_degradation > 50%"
        - "critical_security_issue"
